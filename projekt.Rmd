---
title: "SAP Projekt"
author: "Statistički Analizirani"
date: "2025-12-10"
output:
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(boot)
library(ggplot2)
```

### Motivacija i opis problema

Moždani udar je hitno medicinsko stanje koje nastaje nakon poremećaja cirkulacije u mozgu. U Hrvatskoj je drugi najveći uzrok smrti te prvi najveći uzrok invaliditeta. Rizik od moždanog udara kod pojedine osobe može ovisiti o više faktora pa se u medicini koriste razni modeli za njegovu procjenu. Nije strana ni uporaba alata zasnovanih na umjernoj inteligenciji. Predikcija moždanog udara bitna je za pravovremenu identifikaciju rizika koje omogućava pravovremene mjere prevencije i osvještavanje populacije.

### Opis skupa podataka

Prikupljeni skup podataka sadrži kliničke podatke o pacijentima i informacije o moždanom udaru. Za svakog pacijenta navedena je vrijednost 12 značajki grupiranih u 4 kategorije: demografski podaci, zdravstveni podaci, fiziološki podaci i životne navike. Cilj je uočiti povezanost izmjerenih podataka i rizika od moždanog udara. Skup podataka sadržava 5,110 zapisa o pacijentima od kojih je njih 249 doživjelo moždani udar. Udio pacijenata koji su doživjeli moždani udar iznosi 4.87%

-   id: jedinstveni identifikator pacijenta
-   gender: spol pacijenta (Male, Female)
-   age: dob pacijenta
-   hypertension: oznaka koja daje informaciju o tome ima li pacijent visoki tlak (0, 1)
-   heart_disease: oznaka koja daje informaciju ima li pacijent neku srčanu bolest (0, 1)
-   ever_married: odgovara na pitanje je li pacijent ikad bio u braku (No, Yes) work_type: tip zaposlenja (children, Govt_job, Never_worked, Private, Self-employed)
-   Residence_type: tip prebivališta u kojem živi pacijent (Rural, Urban)
-   avg_glucose_lvl: prosječna razina glukoze u krvi (mg/dL)
-   bmi: indeks tjelesne mase koji predstavlja odnos visine i težine pacijenta
-   smoking_status: opis pacijentovog odnosa s pušenjem cigareta (formerly smoked, never smoked, smokes, Unknown)
-   stroke: oznaka koja daje informaciju je li pacijent doživio moždani udar (0, 1)

### Učitavanje i pregled podataka

```{r}
data <- read.csv("data.csv")
head(data)
```

```{r}
str(data)
```

Iz generiranih prikaza moguće je vidjeti neke od vrijednosti koje poprimaju pojedini atributi vezani uz pacijenta, ali i tip podataka koji prikazuju. Primjetljivo je kako se atribut bmi vodi kao niz znakova iako semantički predstavlja decimalni broj. Pri izradi dijagrama i u budućim računima potrebno je pripaziti da se bmi ne prikaže kao kategorični atribut.

#### Prikaz demografskih podataka

```{r}
par(mfrow = c(1,3))
hist(data$age , main = "Distribucija dobi", xlab = "Dob", col = "lightblue", border = "black")
barplot(table(data$gender), main = "Distribucija spola", xlab = "Spol", col = c("pink","lightblue","black"),border="black")
barplot(table(data$ever_married), main = "Distribucija bracnog statusa", xlab = "Bracni status", col = c("orange","lightblue"),border="black")

```

#### Prikaz zdravstvenih podataka

Kao što je prethodno navedeno, potrebno je pripremiti atribut bmi.

```{r}

bmi<-data$bmi

bmi[bmi == "N/A"] <- NA
bmi <- as.numeric(bmi)

```

```{r}
par(mfrow = c(2,2))
barplot(table(data$hypertension), main = "Distribucija hipertenzije", xlab = "Hipertenzija", col = c("orange","lightblue"),border="black")
barplot(table(data$heart_disease), main = "Distribucija srcanih bolesti", xlab = "Srcane bolesti", col = c("orange","lightblue"),border="black")
hist(data$avg_glucose_level , main = "Distribucija kolicine glukoze u krvi", xlab = "Kolicina glukoze u krvi [mg/dL]", col = "lightblue", border = "black")
hist(bmi , main = "Distribucija indeksa BMI", xlab = "BMI", col = "lightblue", border = "black")

```

#### Prikaz podataka o životnim navikama

```{r}
par(mfrow = c(2,2))
barplot(table(data$smoking_status), main = "Distribucija statusa pusenja", xlab = "Status pusenja", col = c("orange","lightblue","yellow","lavender"),border="black")
barplot(table(data$work_type), main = "Distribucija tipa zaposlenja", xlab = "Tip zaposlenja", col = c("orange","lightblue","yellow","lavender","aquamarine"),border="black")
barplot(table(data$Residence_type), main = "Distribucija tipa prebivališta", xlab = "Tip prebivališta", col = c("orange","lightblue","yellow","lavender"),border="black")

```

### Postoji li statistički značajna razlika u prosječnoj razini glukoze između pacijenata sa i bez moždanog udara?

```{r}
data_stroke <- data[data$stroke == 1, ]$avg_glucose_level
data_no_stroke <- data[data$stroke == 0,]$avg_glucose_level
summary(data_stroke)
summary(data_no_stroke)
```

```{r}
hist(data$avg_glucose_level, freq = FALSE, col = "lightblue", border = "black")
curve(dnorm(x, mean(data$avg_glucose_level), sd(data$avg_glucose_level)), add = TRUE, col = "red")

```

```{r}
set.seed(67)

B <- 10000

boot_diff <- numeric(B)

for (i in 1:B) {
  boot_data_stroke <- sample(data_stroke, replace = TRUE)
  boot_data_no_stroke <- sample(data_no_stroke, replace = TRUE)
  boot_diff[i] <- mean(boot_data_stroke) - mean(boot_data_no_stroke)
}

# Observed mean difference
obs_diff <- mean(data_stroke) - mean(data_no_stroke)

# 95% bootstrap confidence interval
ci <- quantile(boot_diff, c(0.025, 0.975))

list(
  observed_mean_difference = obs_diff,
  ci_95 = ci
)

```

```{r}
head(data)
```

### Postoji li interakcijski učinak hipertenzije i srčanih bolesti na BMI?

U ovom istraživačkom pitanju proučavamo ovisi li indeks tjelesne mase (BMI) o prisutnosti hipertenzije i srčanih bolesti te postoji li interakcijski učinak ova dva čimbenika. Dakle, zanima nas utječe li hipertenzija na BMI jednako kod osoba sa i bez srčanih bolesti ili se taj učinak mijenja ovisno o postojanju srčane bolesti. Za potrebe analize koristimo dvostruku analizu varijance s hipertenzijom i srčanim bolestima kao čimbenicima te BMI-jem kao zavisnom varijablom.

## Priprema podataka

Najprije pripremamo podatke. Brišemo nedostajuće vrijednosti BMI-ja, pretvaramo BMI u numeričku varijablu te kodiramo hipertenziju i srčane bolesti kao faktore s dvije razine.

```{r novi dataset}
data2 <- read.csv("data.csv", na.strings = "N/A", stringsAsFactors = FALSE)
```

```{r}
data2$hypertension  <- factor(data2$hypertension, levels = c(0,1), labels = c("no_hypertension","has_hypertension"))
data2$heart_disease <- factor(data2$heart_disease, levels = c(0,1), labels = c("no_heart_disease","has_heart_disease"))


data2$bmi <- as.numeric(data$bmi)


anova_data <- data2[, c("bmi", "hypertension", "heart_disease")]


anova_data <- na.omit(anova_data)


str(anova_data$bmi)
summary(anova_data$bmi)
table(anova_data$hypertension, anova_data$heart_disease)
```

Broj opažanja nakon izbacivanja nedostajućih vrijednosti daje nam efektivnu veličinu uzorka za ovu analizu.

Ukupno je u analizi sudjelovalo 4 909 ispitanika.\
Raspodjela prema prisutnosti hipertenzije i srčane bolesti je sljedeća:

-   nema hipertenziju, nema srčanu bolest: **87.0 %**
-   nema hipertenziju, ima srčanu bolest: **3.8 %**
-   ima hipertenziju, nema srčanu bolest: **8.0 %**
-   ima hipertenziju, ima srčanu bolest: **1.2 %**

Promatramo li postotke unutar razina hipertenzije:

-   među osobama **bez hipertenzije**:

    -   95.9 % **nema** srčanu bolest
    -   4.1 % **ima** srčanu bolest

-   među osobama **s hipertenzijom**:

    -   87.1 % **nema** srčanu bolest
    -   12.9 % **ima** srčanu bolest

Promatramo li postotke unutar razina srčane bolesti:

-   među osobama **bez srčane bolesti**:

    -   91.6 % **nema** hipertenziju
    -   8.4 % **ima** hipertenziju

-   među osobama **sa srčanom bolešću**:

    -   76.1 % **nema** hipertenziju
    -   23.9 % **ima** hipertenziju

```{r}
head(anova_data)
```

## Sredine po grupama (da znaš što zapravo znači rezultat)

Najprije izračunavamo prosječne vrijednosti BMI-ja po svakoj kombinaciji hipertenzije i srčane bolesti te ih vizualiziramo.

```{r}
aggregate(bmi ~ hypertension + heart_disease,
          data = anova_data,
          FUN = mean)
```

```{r boxplot-bmi, message=FALSE, warning=FALSE, fig.width=8, fig.height=5}
ggplot(anova_data,
       aes(x = interaction(hypertension, heart_disease),
           y = bmi,
           fill = heart_disease)) +
  geom_boxplot() +
  labs(x = "Hypertension x heart disease",
       y = "BMI",
       fill = "heart disease",
       title = "BMI distribution for combinations of hypertension and heart diseases") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))


```

```{r interakcijski-graf, fig.width=10, fig.height=8}
with(anova_data,
     interaction.plot(hypertension, heart_disease, bmi,
                      fun = mean,
                      xlab = "Hypertension",
                      ylab = "Average BMI",
                      trace.label = "Heart disease"))
```

Iz tablice sredina i grafova vidimo kako se prosječni BMI razlikuje između grupa. Zbog toga nas zanima mijenja li se razlika u BMI-ju između osoba s i bez hipertenzije ovisno o tome imaju li srčanu bolest, što je indikacija mogućeg interakcijskog učinka.

## Dvostruka ANOVA s interakcijom: formulacija hipoteza i primjena testa

Glavni učinak hipertenzije:

-   H0: prosječni BMI je jednak kod osoba sa i bez hipertenzije

-   H1: prosječni BMI se razlikuje između osoba sa i bez hipertenzije

Glavni učinak srčanih bolesti:

-   H0: prosječni BMI je jednak kod osoba sa i bez srčane bolesti

-   H1: prosječni BMI se razlikuje između osoba sa i bez srčane bolesti

Interakcijski učinak:

-   H0: nema interakcijskog učinka hipertenzije i srčanih bolesti na BMI

-   H1: postoji interakcijski učinak hipertenzije i srčanih bolesti na BMI

Za testiranje hipoteza koristimo dvostruku ANOVA-u s interakcijom:

```{r}
test_anova <- aov(bmi ~ hypertension * heart_disease, data = anova_data)
summary(test_anova)
```

## Provjera pretpostavki

Analiza varijance pretpostavlja približnu normalnost reziduala i sličnost varijanci između grupa.

```{r}
rezid <- residuals(test_anova)

par(mfrow = c(1, 2))
hist(rezid, main = "Residual histogram", xlab = "Residual", col = "lightblue", border = "black")
qqnorm(rezid, main = "QQ residual graf")
qqline(rezid, col = "red")
par(mfrow = c(1, 1))
```

Reziduali pokazuju određena odstupanja, no zbog velikog uzorka ANOVA je relativno robusna na takva odstupanja.

## Rezultati i interpretacija

Na temelju ANOVA tablice zaključujemo sljedeće:

-   Glavni učinak hipertenzije na BMI je statistički značajan (F vrijednost je vrlo velika, p \< 0.001), zbog čega možemo zaključiti da osobe s hipertenzijom u prosjeku imaju viši BMI od osoba bez hipertenzije.

-   Glavni učinak srčanih bolesti na BMI nije statistički značajan (p-vrijednost je veća od 0.05), pa na ovoj razini značajnosti zaklučujemo da prosječni BMI razlikuje između osoba sa i bez srčane bolesti kada se ostali čimbenici ne uzimaju u obzir.

-   Interakcijski učinak hipertenzije i srčanih bolesti na BMI je statistički značajan (p \< 0.01), zbog čega zaključujemo da se učinak hipertenzije na BMI razlikuje ovisno o tome ima li osoba srčanu bolest.

Iz tablice prosječnih BMI vrijednosti po grupama vidimo da je najviši BMI tipično prisutan kod osoba koje imaju i hipertenziju i srčanu bolest, dok je najniži BMI kod osoba koje nemaju ni hipertenziju ni srčanu bolest.
